# ■■■ ダミーECサイト側 (Port: 3000) README.md ■■■

# 🛒 Demo EC Store (Client Site)

マーケティングツールの動作を検証・シミュレーションするためのデモ用ECサイトです。Elasticsearchによる高度な検索機能と、ツール連携用のトラッキング機能を備えています。

## 🎯 役割
- **スニペットの実行**: 3001番サーバーから配信される計測タグ（`api/v1/snippet`）の読み込み。
- **ポップアップのレンダリング**: 配信条件にマッチした際の動的な要素注入と表示。
- **高速商品検索**: Elasticsearchを使用した、高度な検索体験の提供。
- **イベント送信**: `Tracker.tsx` による商品閲覧やクリック等の行動データ送信。

## 🔍 検索機能の仕様 (Elasticsearch)
- **リアルタイム検索**: `use client` とデバウンス処理による、ストレスのない検索結果反映。
- **高度なスコアリング**: `function_score` を用い、以下の要素で検索順位を動的に調整。
    - キーワード適合度（商品名 > 説明文）
    - セール対象フラグ (`isSale: true`) によるブースト
    - 管理画面で設定された優先度 (`priority`) の反映
    - 価格に応じた微調整 (`log1p`)
- **動的ファセット**: 検索結果に基づいたカテゴリ別件数のリアルタイム集計。
- **日本語最適化**: `wildcard` クエリ等により、柔軟な部分一致検索に対応。

## 🔌 マーケティングツールとの連携
共通レイアウト（`layout.tsx`）にて `Tracker` コンポーネントを介し、以下の連携を行っています。

1. **スクリプト読み込み**: 
   `<script src="http://localhost:3001/api/v1/snippet"></script>`
2. **行動トラッキング**:
   `POST http://localhost:3001/api/v1/track` へページ遷移やクリックイベントを送信。

## 🚀 起動方法
1. **インフラ起動**: `docker-compose up -d` (Elasticsearch / Redis)
2. **依存関係のインストール**: `npm install`
3. **開発サーバーの起動**: `npm run dev` (Port: 3000)

## 🧪 テスト項目
- 検索窓で文字入力し、デバウンスを経て結果が自動更新されるか。
- サイドバーのカテゴリを選択し、ファセット集計が正しく切り替わるか。
- 商品クリック時、3001側のDB（またはDuckDB/S3）にログが記録されるか。
- 3001側で更新した商品マスタ（CMS）が、検索結果に即座に反映されるか。

---
*Next.js Marketing SaaS Project - Frontend Demo Site*